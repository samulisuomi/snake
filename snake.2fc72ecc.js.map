{"version":3,"sources":["index.js"],"names":["window","SnakeGame","initialize","height","width","field","Array","fill","forEach","_cell","index","headY","headX","Math","floor","tailY","tailX","i","inputBuffer","direction","gameOver","onMouseDown","event","target","textContent","addInputToBuffer","onKeyDown","code","inputDirection","previousInput","length","nextHeadY","nextHeadX","nextTailY","nextTailX","getInvertedDirection","moveSnake","endGame","oldHeadX","oldHeadY","sort","join","oldTailX","oldTailY","oldTailDirection","invertedOldTailDirection","split","filter","onTick","firstInput","otherInputs","draw","console","log","getTileName","directions","containerElement","document","querySelector","topBorderRowElement","createElement","className","topLeftBorderCellElement","appendChild","borderCellElement","topRightBorderCellElement","row","rowElement","leftBorderCellElement","cell","cellElement","rightBorderCellElement","bottomBorderRowElement","bottomLeftBorderCellElement","bottomRightBorderCellElement","addEventListener","_event","setInterval"],"mappings":"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","file":"snake.2fc72ecc.js","sourceRoot":"..","sourcesContent":["window.SnakeGame = this\r\n\r\nthis.initialize = () => {\r\n  this.height = 11\r\n  this.width = 20\r\n\r\n  this.field = new Array(this.height).fill([])\r\n  this.field.forEach((_cell, index) => {\r\n    this.field[index] = new Array(this.width).fill(0)\r\n  })\r\n  this.headY = this.height - 1\r\n  this.headX = Math.floor((this.width - 1) / 2)\r\n  this.tailY = this.headY\r\n  this.tailX = 0\r\n  for (let i = this.tailX; i <= this.headX; i++) {\r\n    this.field[this.tailY][i] =\r\n      i === this.headX ?\r\n        \"l\" : i === this.tailX ?\r\n          \"r\" : \"lr\"\r\n  }\r\n\r\n  this.inputBuffer = []\r\n  this.direction = 'r'\r\n  this.gameOver = false\r\n}\r\n\r\nthis.onMouseDown = event => {\r\n  switch (event.target.textContent) {\r\n    case '2':\r\n      return this.addInputToBuffer('u')\r\n    case '6':\r\n      return this.addInputToBuffer('r')\r\n    case '8':\r\n      return this.addInputToBuffer('d')\r\n    case '4':\r\n      return this.addInputToBuffer('l')\r\n    default:\r\n      if (this.gameOver) {\r\n        this.initialize()\r\n      }\r\n  }\r\n}\r\n\r\nthis.onKeyDown = event => {\r\n  switch (event.code) {\r\n    case 'ArrowUp':\r\n    case 'KeyW':\r\n      return this.addInputToBuffer('u')\r\n    case 'ArrowRight':\r\n    case 'KeyD':\r\n      return this.addInputToBuffer('r')\r\n    case 'ArrowDown':\r\n    case 'KeyS':\r\n      return this.addInputToBuffer('d')\r\n    case 'ArrowLeft':\r\n    case 'KeyA':\r\n      return this.addInputToBuffer('l')\r\n    case 'Enter':\r\n      debugger\r\n    default:\r\n      if (this.gameOver) {\r\n        this.initialize()\r\n      }\r\n  }\r\n}\r\n\r\nthis.addInputToBuffer = inputDirection => {\r\n  const previousInput = this.inputBuffer[this.inputBuffer.length - 1] || this.direction\r\n\r\n  switch (inputDirection) {\r\n    case 'u':\r\n    case 'd':\r\n      if (previousInput !== 'u' && previousInput !== 'd') {\r\n        this.inputBuffer = [...this.inputBuffer, inputDirection]\r\n      }\r\n      break\r\n    case 'l':\r\n    case 'r':\r\n      if (previousInput !== 'r' && previousInput !== 'l') {\r\n        this.inputBuffer = [...this.inputBuffer, inputDirection]\r\n      }\r\n      break\r\n  }\r\n}\r\n\r\nthis.nextHeadY = () => {\r\n  switch(this.direction) {\r\n    case 'u':\r\n      return this.headY - 1\r\n    case 'd':\r\n      return this.headY + 1\r\n    default:\r\n      return this.headY\r\n  }\r\n}\r\n\r\nthis.nextHeadX = () => {\r\n  switch(this.direction) {\r\n    case 'l':\r\n      return this.headX - 1\r\n    case 'r':\r\n      return this.headX + 1\r\n    default:\r\n      return this.headX\r\n  }\r\n}\r\n\r\nthis.nextTailY = direction => {\r\n  switch(direction) {\r\n    case 'u':\r\n      return this.tailY - 1\r\n    case 'd':\r\n      return this.tailY + 1\r\n    default:\r\n      return this.tailY\r\n  }\r\n}\r\n\r\nthis.nextTailX = direction => {\r\n  switch(direction) {\r\n    case 'l':\r\n      return this.tailX - 1\r\n    case 'r':\r\n      return this.tailX + 1\r\n    default:\r\n      return this.tailX\r\n  }\r\n}\r\n\r\nthis.getInvertedDirection = direction => {\r\n  switch(direction) {\r\n    case 'u':\r\n      return 'd'\r\n    case 'r':\r\n      return 'l'\r\n    case 'd':\r\n      return 'u'\r\n    case 'l':\r\n      return 'r'\r\n  }\r\n}\r\n\r\nthis.moveSnake = () => {\r\n  const nextHeadX = this.nextHeadX()\r\n  const nextHeadY = this.nextHeadY()\r\n\r\n  if (nextHeadX < 0 || nextHeadX >= this.width || nextHeadY < 0 || nextHeadY >= this.height) {\r\n    return this.endGame()\r\n  }\r\n\r\n  if (this.field[nextHeadY][nextHeadX] /* && !(nextHeadY === this.tailY && nextHeadX === this.tailX) */) {\r\n    return this.endGame()\r\n  }\r\n\r\n  // TODO: Check if the snake would collide\r\n\r\n  // Update the head:\r\n\r\n  const oldHeadX = this.headX\r\n  const oldHeadY = this.headY\r\n  this.headX = nextHeadX\r\n  this.headY = nextHeadY\r\n\r\n  this.field[oldHeadY][oldHeadX] = [this.field[oldHeadY][oldHeadX], this.direction].sort().join('')\r\n  this.field[this.headY][this.headX] = this.getInvertedDirection(this.direction)\r\n\r\n  // Update the tail:\r\n  const oldTailX = this.tailX\r\n  const oldTailY = this.tailY\r\n  const oldTailDirection = this.field[this.tailY][this.tailX]\r\n  const invertedOldTailDirection = this.getInvertedDirection(oldTailDirection)\r\n\r\n  const nextTailX = this.nextTailX(oldTailDirection)\r\n  const nextTailY = this.nextTailY(oldTailDirection)\r\n  this.tailX = nextTailX\r\n  this.tailY = nextTailY\r\n\r\n  if (!(this.headX === oldTailX && this.headY === oldTailY)) {\r\n    this.field[oldTailY][oldTailX] = 0\r\n  }\r\n  // if (!this.field[this.tailY][this.tailX]) {\r\n  //   debugger\r\n  // }\r\n\r\n  this.field[this.tailY][this.tailX] = this.field[this.tailY][this.tailX].split('').filter(direction => direction !== invertedOldTailDirection).join('')\r\n}\r\n\r\nthis.onTick = () => {\r\n  if (this.inputBuffer.length) {\r\n    const [firstInput, ...otherInputs] = this.inputBuffer\r\n\r\n    this.direction = firstInput\r\n    this.inputBuffer = otherInputs\r\n  }\r\n  if (!this.gameOver) {\r\n    this.moveSnake()\r\n    this.draw()\r\n  }\r\n}\r\n\r\nthis.endGame = () => {\r\n  this.gameOver = true\r\n  console.log('Game over')\r\n}\r\n\r\nthis.getTileName = directions => {\r\n  switch(directions) {\r\n    case 'lr':\r\n    case 'r':\r\n    case 'ru':\r\n      return 'lr-r-ru'\r\n    case 'd':\r\n    case 'dl':\r\n    case 'du':\r\n      return 'd-dl-du'\r\n    case 'l':\r\n    case 'lu':\r\n    case 'u':\r\n      return 'l-lu-u'\r\n    case 'dr':\r\n      return 'dr'\r\n  }\r\n}\r\n\r\n// TODO: Use canvas + https://developer.mozilla.org/en-US/docs/Games/Techniques/Crisp_pixel_art_look :\r\nthis.draw = () => {\r\n  const containerElement = document.querySelector('.snake')\r\n  containerElement.textContent = ''\r\n\r\n  // Top border:\r\n\r\n  const topBorderRowElement = document.createElement('div')\r\n  topBorderRowElement.className = 'row'\r\n\r\n  const topLeftBorderCellElement = document.createElement('div')\r\n  topLeftBorderCellElement.className = 'border-cell top-left'\r\n  topBorderRowElement.appendChild(topLeftBorderCellElement)\r\n\r\n  for (let i = 0; i < this.width; i++) {\r\n    const borderCellElement = document.createElement('div')\r\n    borderCellElement.className = 'border-cell top'\r\n    topBorderRowElement.appendChild(borderCellElement)\r\n  }\r\n\r\n  const topRightBorderCellElement = document.createElement('div')\r\n  topRightBorderCellElement.className = 'border-cell top-right'\r\n  topBorderRowElement.appendChild(topRightBorderCellElement)\r\n\r\n  containerElement.appendChild(topBorderRowElement)\r\n\r\n  // Left border + playable area + right border:\r\n\r\n  this.field.forEach(row => {\r\n    const rowElement = document.createElement('div')\r\n    rowElement.className = 'row'\r\n\r\n    const leftBorderCellElement = document.createElement('div')\r\n    leftBorderCellElement.className = 'border-cell left'\r\n    rowElement.appendChild(leftBorderCellElement)\r\n\r\n    row.forEach(cell => {\r\n      const cellElement = document.createElement('div')\r\n      cellElement.className = `cell ${cell ? `snake ${this.getTileName(cell)}` : ''}`\r\n      rowElement.appendChild(cellElement)\r\n    })\r\n\r\n    const rightBorderCellElement = document.createElement('div')\r\n    rightBorderCellElement.className = 'border-cell right'\r\n    rowElement.appendChild(rightBorderCellElement)\r\n\r\n    containerElement.appendChild(rowElement)\r\n  })\r\n\r\n  // Bottom border:\r\n\r\n  const bottomBorderRowElement = document.createElement('div')\r\n  bottomBorderRowElement.className = 'row'\r\n\r\n  const bottomLeftBorderCellElement = document.createElement('div')\r\n  bottomLeftBorderCellElement.className = 'border-cell bottom-left'\r\n  bottomBorderRowElement.appendChild(bottomLeftBorderCellElement)\r\n\r\n  for (let i = 0; i < this.width; i++) {\r\n    const borderCellElement = document.createElement('div')\r\n    borderCellElement.className = 'border-cell bottom'\r\n    bottomBorderRowElement.appendChild(borderCellElement)\r\n  }\r\n\r\n  const bottomRightBorderCellElement = document.createElement('div')\r\n  bottomRightBorderCellElement.className = 'border-cell bottom-right'\r\n  bottomBorderRowElement.appendChild(bottomRightBorderCellElement)\r\n\r\n  containerElement.appendChild(bottomBorderRowElement)\r\n}\r\n\r\nwindow.addEventListener('DOMContentLoaded', _event => {\r\n  this.initialize()\r\n  this.draw()\r\n  document.querySelector('.keyboard').addEventListener('mousedown', this.onMouseDown)\r\n  document.addEventListener('keydown', this.onKeyDown)\r\n  setInterval(this.onTick, 500)\r\n})"]}